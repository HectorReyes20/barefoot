<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <th:block th:insert="~{admin/layout/head :: head(titulo=(${esEdicion} ? 'Editar ' + ${producto.nombre} : 'Nuevo Producto') + ' - Barefoot Admin')}"></th:block>
  <link th:href="@{/css/form-producto.css}" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">


</head>
<body>

<div th:replace="~{admin/layout/sidebar :: sidebar(paginaActiva='productos')}"></div>

<div class="main-content">

  <div th:replace="~{admin/layout/navbar :: navbar(tituloPagina=(${esEdicion} ? 'Editar Producto' : 'Nuevo Producto'))}"></div>

  <form th:action="${esEdicion} ? @{/admin/productos/actualizar/{id}(id=${producto.id})} : @{/admin/productos/guardar}"
        method="post" th:object="${producto}" id="productForm">

    <div class="d-flex justify-content-end align-items-center mb-4">
      <a th:href="@{/admin/productos}" class="btn-cancel">Descartar</a>
      <button type="submit" class="btn-save shadow-sm">
        <i class="fas fa-save me-2"></i> <span th:text="${esEdicion} ? 'Guardar Cambios' : 'Publicar Producto'">Guardar</span>
      </button>
    </div>

    <div class="editor-grid">

      <div class="left-column">

        <div class="editor-card">
          <h5><i class="fas fa-pen-nib text-primary"></i> InformaciÃ³n General</h5>

          <div class="mb-3">
            <label for="nombre" class="form-label">Nombre del Producto</label>
            <input type="text" class="form-control form-control-lg fw-bold" id="nombre"
                   th:field="*{nombre}" placeholder="Ej: Urban Barefoot Classic" required>
          </div>

          <div class="mb-0">
            <label for="descripcion" class="form-label">DescripciÃ³n</label>
            <textarea class="form-control" id="descripcion" rows="5"
                      th:field="*{descripcion}"
                      placeholder="Describe las caracterÃ­sticas, materiales y beneficios..."></textarea>
            <div class="form-text text-end" id="descCount">0 caracteres</div>
          </div>
        </div>

        <div class="editor-card">
          <h5><i class="fas fa-tag text-success"></i> Precios</h5>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="precio" class="form-label">Precio Regular (S/)</label>
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0">S/</span>
                <input type="number" class="form-control border-start-0 ps-1 fw-bold" id="precio"
                       th:field="*{precio}" step="0.01" min="0" placeholder="0.00" required>
              </div>
            </div>
            <div class="col-md-6">
              <label for="precioDescuento" class="form-label">Precio Oferta (S/)</label>
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0">S/</span>
                <input type="number" class="form-control border-start-0 ps-1" id="precioDescuento"
                       th:field="*{precioDescuento}" step="0.01" min="0" placeholder="0.00">
              </div>
              <small class="text-success mt-1 d-block fw-bold" id="discountLabel"></small>
            </div>
          </div>
        </div>

        <div class="editor-card">
          <h5><i class="fas fa-boxes text-warning"></i> Inventario & Variantes</h5>
          <div class="row g-3">
            <div class="col-md-4">
              <label for="stock" class="form-label">Stock Disponible</label>
              <input type="number" class="form-control" id="stock"
                     th:field="*{stock}" min="0" required>
            </div>

            <div class="col-md-4">
              <label for="talla" class="form-label">Talla</label>
              <select class="form-select" id="talla" th:field="*{talla}">
                <option value="">Ãšnica</option>
                <option th:each="i : ${#numbers.sequence(35, 45)}" th:value="${i}" th:text="${i}"></option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="color" class="form-label">Color</label>
              <select class="form-select" id="color" th:field="*{color}">
                <option value="">Seleccionar...</option>
                <option value="Negro">âš« Negro</option>
                <option value="Blanco">âšª Blanco</option>
                <option value="MarrÃ³n">ðŸŸ¤ MarrÃ³n</option>
                <option value="Beige">ðŸŸ¡ Beige</option>
                <option value="Azul">ðŸ”µ Azul</option>
                <option value="Rojo">ðŸ”´ Rojo</option>
              </select>
            </div>
          </div>
        </div>

      </div>

      <div class="right-column">

        <div class="editor-card">
          <h5>PublicaciÃ³n</h5>

          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="activo" th:field="*{activo}">
            <label class="form-check-label" for="activo">Visible en Tienda</label>
          </div>

          <div class="form-check form-switch mb-0">
            <input class="form-check-input" type="checkbox" id="destacado" th:field="*{destacado}">
            <label class="form-check-label" for="destacado">Producto Destacado</label>
          </div>
        </div>

        <div class="editor-card">
          <h5>OrganizaciÃ³n</h5>
          <label for="categoria" class="form-label">CategorÃ­a</label>
          <select class="form-select mb-3" id="categoria" th:field="*{categoria}" required>
            <option value="">Selecciona...</option>
            <option value="Casual">Casual</option>
            <option value="Deportivo">Deportivo</option>
            <option value="Formal">Formal</option>
            <option value="Running">Running</option>
          </select>

          <label for="material" class="form-label">Material</label>
          <select class="form-select" id="material" th:field="*{material}">
            <option value="Cuero">Cuero</option>
            <option value="Lona">Lona</option>
            <option value="SintÃ©tico">SintÃ©tico</option>
          </select>
        </div>

        <div class="editor-card">
          <h5>Imagen Principal</h5>

          <div class="mb-2">
            <input type="url" class="form-control form-control-sm" id="imagenUrl"
                   th:field="*{imagenUrl}"
                   placeholder="Pegar URL de imagen..."
                   oninput="updatePreview()">
          </div>

          <div class="image-preview-area" id="previewContainer">
            <div class="placeholder-text" id="placeholder">
              <i class="fas fa-image fa-2x mb-2 text-muted"></i><br>
              <small>La vista previa aparecerÃ¡ aquÃ­</small>
            </div>
            <img id="previewImg" src="" style="display: none;" onerror="this.style.display='none'; document.getElementById('placeholder').style.display='block';">
          </div>
        </div>

      </div>

    </div>
  </form>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // 1. Preview de Imagen Robusto
  function updatePreview() {
      const url = document.getElementById('imagenUrl').value;
      const img = document.getElementById('previewImg');
      const placeholder = document.getElementById('placeholder');

      if (url && url.length > 10) {
          img.src = url;
          img.style.display = 'block';
          placeholder.style.display = 'none';
      } else {
          img.style.display = 'none';
          placeholder.style.display = 'block';
      }
  }

  // Ejecutar al cargar (para ediciÃ³n)
  window.addEventListener('load', updatePreview);

  // 2. Calculadora de Descuento en Tiempo Real
  const precioInput = document.getElementById('precio');
  const descuentoInput = document.getElementById('precioDescuento');
  const label = document.getElementById('discountLabel');

  function calcDiscount() {
      const p = parseFloat(precioInput.value) || 0;
      const d = parseFloat(descuentoInput.value) || 0;

      if (d > 0 && d < p) {
          const pct = Math.round(((p - d) / p) * 100);
          label.textContent = `ðŸ”¥ Ahorras un ${pct}%`;
      } else {
          label.textContent = '';
      }
  }

  precioInput.addEventListener('input', calcDiscount);
  descuentoInput.addEventListener('input', calcDiscount);
  window.addEventListener('load', calcDiscount);

  // 3. Contador de caracteres (opcional)
  document.getElementById('descripcion').addEventListener('input', function() {
      document.getElementById('descCount').textContent = this.value.length + ' caracteres';
  });
</script>

</body>
</html>