<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/layout/head :: head(titulo='Dashboard Admin - Barefoot Store')}"></head>

<body>

<div th:replace="~{admin/layout/sidebar :: sidebar(paginaActiva='dashboard')}"></div>

<div class="main-content">

    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="fw-bold m-0" style="color: var(--text-main);">Dashboard</h2>
            <p class="text-muted m-0">
                Hola de nuevo, <strong class="text-dark" th:text="${nombreUsuario}">Admin</strong> ðŸ‘‹
            </p>
        </div>

        <div class="d-flex align-items-center gap-3">
            <button class="btn btn-white border shadow-sm position-relative" style="width: 45px; height: 45px; border-radius: 12px;">
                <i class="fas fa-bell text-muted"></i>
                <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle">
                    <span class="visually-hidden">Alertas</span>
                </span>
            </button>

            <div class="d-flex align-items-center gap-3 bg-white border shadow-sm ps-2 pe-4 py-2" style="border-radius: 50px;">
                <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center fw-bold"
                     style="width: 38px; height: 38px; font-size: 1rem;"
                     th:text="${nombreUsuario != null ? #strings.substring(nombreUsuario, 0, 1) : 'A'}">
                    A
                </div>

                <div style="line-height: 1.2;">
                    <span class="d-block fw-bold text-dark" style="font-size: 0.9rem;" th:text="${nombreUsuario}">Admin</span>
                    <span class="d-block text-muted" style="font-size: 0.75rem;">Administrador</span>
                </div>
            </div>
        </div>
    </div>

    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-info">
                <p>Pedidos Totales</p>
                <h3 th:text="${estadisticas.pedidosTotales}">0</h3>
            </div>
            <div class="stat-icon blue">
                <i class="fas fa-shopping-cart"></i>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-info">
                <p>Ingresos del Mes</p>
                <h3 th:text="'S/ ' + ${#numbers.formatDecimal(estadisticas.ventasMes, 1, 'COMMA', 2, 'POINT')}">S/ 0.00</h3>
            </div>
            <div class="stat-icon green">
                <i class="fas fa-wallet"></i>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-info">
                <p>Clientes Nuevos</p>
                <h3 th:text="${estadisticas.totalUsuarios}">0</h3>
            </div>
            <div class="stat-icon orange">
                <i class="fas fa-users"></i>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-info">
                <p>Productos Activos</p>
                <h3 th:text="${estadisticas.productosActivos}">0</h3>
            </div>
            <div class="stat-icon purple">
                <i class="fas fa-layer-group"></i>
            </div>
        </div>
    </div>

    <div class="content-card">
        <h4><i class="fas fa-bolt me-2 text-warning"></i> Acciones RÃ¡pidas</h4>
        <div class="quick-actions">
            <a th:href="@{/admin/productos/nuevo}" class="quick-action-btn">
                <div class="stat-icon blue mb-2"><i class="fas fa-plus"></i></div>
                <strong>Nuevo Producto</strong>
                <small class="text-muted">AÃ±adir al catÃ¡logo</small>
            </a>
            <a th:href="@{/admin/productos}" class="quick-action-btn">
                <div class="stat-icon purple mb-2"><i class="fas fa-boxes"></i></div>
                <strong>Gestionar Stock</strong>
                <small class="text-muted">Ver inventario</small>
            </a>
            <a href="#clientes" class="quick-action-btn">
                <div class="stat-icon orange mb-2"><i class="fas fa-user-plus"></i></div>
                <strong>Nuevo Cliente</strong>
                <small class="text-muted">Registro manual</small>
            </a>
            <a href="#reportes" class="quick-action-btn">
                <div class="stat-icon green mb-2"><i class="fas fa-file-invoice-dollar"></i></div>
                <strong>Reporte Mensual</strong>
                <small class="text-muted">Descargar PDF</small>
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-7">
            <div class="content-card h-100">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Productos Recientes</h4>
                    <a th:href="@{/admin/productos}" class="btn btn-sm btn-outline-primary rounded-pill">Ver todos</a>
                </div>

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Precio</th>
                            <th>Estado</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.isEmpty(productosRecientes)}">
                            <td colspan="3" class="text-center text-muted py-4">Sin actividad reciente</td>
                        </tr>
                        <tr th:each="producto : ${productosRecientes}">
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="rounded bg-light d-flex align-items-center justify-content-center me-3"
                                         style="width: 40px; height: 40px;">
                                        <i class="fas fa-box text-muted"></i>
                                    </div>
                                    <div>
                                        <span class="d-block fw-bold text-dark" th:text="${producto.nombre}">Nom</span>
                                        <small class="text-muted" th:text="${producto.categoria}">Cat</small>
                                    </div>
                                </div>
                            </td>
                            <td class="fw-bold" th:text="'S/ ' + ${producto.precio}">S/ 0</td>
                            <td>
                                <span class="badge bg-info"
                                      th:classappend="${producto.stock < 10} ? 'bg-warning text-dark' : 'bg-success text-white bg-opacity-75'"
                                      th:text="${producto.stock < 10 ? 'Stock Bajo' : 'En Stock'}">Status</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="content-card h-100 border-warning border-opacity-25" style="background: #FFFBF0;">
                <h4 class="text-dark"><i class="fas fa-exclamation-triangle me-2 text-warning"></i> Stock CrÃ­tico</h4>

                <div class="table-responsive">
                    <table class="table table-borderless bg-transparent">
                        <thead style="background: transparent;">
                        <tr>
                            <th class="bg-transparent text-dark opacity-50">Item</th>
                            <th class="bg-transparent text-end text-dark opacity-50">Cant.</th>
                            <th class="bg-transparent"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="producto : ${productosStockBajo}" class="border-bottom border-warning border-opacity-10">
                            <td class="bg-transparent fw-bold text-dark" th:text="${producto.nombre}">Producto</td>
                            <td class="bg-transparent text-end">
                                <span class="badge bg-danger rounded-pill" th:text="${producto.stock}">0</span>
                            </td>
                            <td class="bg-transparent text-end">
                                <a th:href="@{/admin/productos/editar/{id}(id=${producto.id})}"
                                   class="btn btn-sm btn-light text-warning hover-shadow">
                                    <i class="fas fa-pen"></i>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>