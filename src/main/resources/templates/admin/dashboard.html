<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Barefoot Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link th:href="@{/css/dashboard.css}" rel="stylesheet">
</head>
<body>
<!-- Sidebar -->
<div class="sidebar">
    <div class="sidebar-header">
        <h3><i class="fas fa-shoe-prints me-2"></i> Barefoot Admin</h3>
        <p>Panel de Administración</p>
    </div>
    <ul class="sidebar-menu">
        <li><a href="#" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
        <li><a th:href="@{/admin/productos}"><i class="fas fa-box"></i> Productos</a></li>
        <li><a th:href="@{/admin/pedidos}"><i class="fas fa-shopping-cart"></i> Pedidos</a></li>
        <li><a href="#clientes"><i class="fas fa-users"></i> Clientes</a></li>
        <li><a href="#personalizaciones"><i class="fas fa-palette"></i> Personalizaciones</a></li>
        <li><a th:href="@{/admin/reportes}"><i class="fas fa-chart-line"></i> Reportes</a></li>
        <li><a href="#inventario"><i class="fas fa-warehouse"></i> Inventario</a></li>
        <li><a href="#configuracion"><i class="fas fa-cog"></i> Configuración</a></li>
        <li><a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a></li>
    </ul>
</div>

<!-- Main Content -->
<div class="main-content">
    <!-- Top Navbar -->
    <div class="top-navbar">
        <h2><i class="fas fa-tachometer-alt me-2"></i> Dashboard</h2>
        <div class="user-info">
            <span><strong>Administrador:</strong> <span th:text="${nombreUsuario}">Admin</span></span>
            <div class="user-avatar">
                <i class="fas fa-user-shield"></i>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-info">
                <h3 th:text="${estadisticas.pedidosTotales}">245</h3>
                <p>Pedidos Totales</p>
            </div>
            <div class="stat-icon blue">
                <i class="fas fa-shopping-cart"></i>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-info">
                <h3 th:text="'S/ ' + ${#numbers.formatDecimal(estadisticas.ventasMes, 1, 'COMMA', 2, 'POINT')}">S/ 45,890</h3>
                <p>Ventas del Mes</p>
            </div>
            <div class="stat-icon green">
                <i class="fas fa-dollar-sign"></i>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-info">
                <h3 th:text="${estadisticas.totalUsuarios}">1,234</h3>
                <p>Clientes Registrados</p>
            </div>
            <div class="stat-icon orange">
                <i class="fas fa-users"></i>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-info">
                <h3 th:text="${estadisticas.productosActivos}">87</h3>
                <p>Productos Activos</p>
            </div>
            <div class="stat-icon purple">
                <i class="fas fa-box"></i>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="content-card">
        <h4><i class="fas fa-bolt me-2"></i> Acciones Rápidas</h4>
        <div class="quick-actions">
            <a th:href="@{/admin/productos/nuevo}" class="quick-action-btn">
                <i class="fas fa-plus-circle"></i>
                <strong>Nuevo Producto</strong>
            </a>
            <a th:href="@{/admin/productos}" class="quick-action-btn">
                <i class="fas fa-box"></i>
                <strong>Ver Productos</strong>
            </a>
            <a href="#clientes" class="quick-action-btn">
                <i class="fas fa-user-plus"></i>
                <strong>Agregar Cliente</strong>
            </a>
            <a href="#reportes" class="quick-action-btn">
                <i class="fas fa-chart-bar"></i>
                <strong>Ver Reportes</strong>
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Productos Recientes -->
        <div class="col-lg-6">
            <div class="content-card">
                <h4><i class="fas fa-clock me-2"></i> Productos Recientes</h4>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Categoría</th>
                            <th>Precio</th>
                            <th>Stock</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.isEmpty(productosRecientes)}">
                            <td colspan="4" class="text-center text-muted">No hay productos recientes</td>
                        </tr>
                        <tr th:each="producto : ${productosRecientes}">
                            <td>
                                <strong th:text="${producto.nombre}">Producto</strong><br>
                                <small class="text-muted"
                                       th:text="${#temporals.format(producto.fechaCreacion, 'dd/MM/yyyy')}">
                                    Fecha
                                </small>
                            </td>
                            <td>
                                <span class="badge bg-info" th:text="${producto.categoria}">Cat</span>
                            </td>
                            <td>
                                <strong th:text="'S/ ' + ${producto.precio}">S/ 0</strong>
                            </td>
                            <td>
                                    <span th:class="${producto.stock < 10} ? 'text-danger fw-bold' : ''"
                                          th:text="${producto.stock}">0</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Productos con Stock Bajo -->
        <div class="col-lg-6">
            <div class="content-card">
                <h4><i class="fas fa-exclamation-triangle me-2 text-warning"></i> Alerta de Stock</h4>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Stock</th>
                            <th>Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.isEmpty(productosStockBajo)}">
                            <td colspan="3" class="text-center text-success">
                                <i class="fas fa-check-circle me-2"></i>
                                Todos los productos tienen stock suficiente
                            </td>
                        </tr>
                        <tr th:each="producto : ${productosStockBajo}">
                            <td>
                                <strong th:text="${producto.nombre}">Producto</strong><br>
                                <small class="text-muted" th:text="${producto.categoria}">Cat</small>
                            </td>
                            <td>
                                <span class="text-danger fw-bold" th:text="${producto.stock}">0</span>
                            </td>
                            <td>
                                <a th:href="@{/admin/productos/editar/{id}(id=${producto.id})}"
                                   class="btn btn-sm btn-primary">
                                    <i class="fas fa-edit"></i> Editar
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráfico de Categorías -->
    <div class="content-card">
        <h4><i class="fas fa-chart-pie me-2"></i> Productos por Categoría</h4>
        <div class="row mt-4">
            <div class="col-md-3" th:each="entry : ${productosPorCategoria}">
                <div class="text-center p-3 border rounded">
                    <h2 class="mb-2" th:text="${entry.value}">0</h2>
                    <p class="mb-0 text-muted" th:text="${entry.key}">Categoría</p>
                </div>
            </div>
            <div class="col-md-3" th:if="${#maps.isEmpty(productosPorCategoria)}">
                <div class="text-center p-3 border rounded">
                    <p class="mb-0 text-muted">No hay productos</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Productos -->
    <div class="content-card">
        <h4><i class="fas fa-star me-2"></i> Productos Destacados</h4>
        <div class="row mt-4">
            <div class="col-md-4" th:each="producto : ${topProductos}">
                <div class="card">
                    <img th:if="${producto.imagenUrl != null}"
                         th:src="${producto.imagenUrl}"
                         class="card-img-top"
                         style="height: 200px; object-fit: cover;"
                         alt="Producto">
                    <div th:if="${producto.imagenUrl == null}"
                         style="height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-image fa-3x text-muted"></i>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title" th:text="${producto.nombre}">Producto</h5>
                        <p class="mb-2">
                            <strong>Precio:</strong>
                            <span th:text="'S/ ' + ${producto.precio}">S/ 0</span>
                        </p>
                        <p class="mb-2">
                            <strong>Stock:</strong>
                            <span th:text="${producto.stock}">0</span>
                        </p>
                        <a th:href="@{/admin/productos/editar/{id}(id=${producto.id})}"
                           class="btn btn-sm btn-primary w-100">
                            <i class="fas fa-edit me-1"></i> Editar
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-12" th:if="${#lists.isEmpty(topProductos)}">
                <p class="text-center text-muted">No hay productos destacados</p>
            </div>
        </div>
    </div>

    <!-- Resumen del Inventario -->
    <div class="content-card">
        <h4><i class="fas fa-warehouse me-2"></i> Resumen del Inventario</h4>
        <div class="row text-center mt-4">
            <div class="col-md-3">
                <div class="p-3 bg-light rounded">
                    <h3 th:text="${estadisticas.totalProductos}">0</h3>
                    <p class="mb-0">Total Productos</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 bg-success bg-opacity-10 rounded">
                    <h3 class="text-success" th:text="${estadisticas.productosActivos}">0</h3>
                    <p class="mb-0">Productos Activos</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 bg-warning bg-opacity-10 rounded">
                    <h3 class="text-warning" th:text="${estadisticas.productosStockBajo}">0</h3>
                    <p class="mb-0">Stock Bajo</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 bg-primary bg-opacity-10 rounded">
                    <h3 class="text-primary"
                        th:text="'S/ ' + ${#numbers.formatDecimal(estadisticas.valorInventario, 1, 'COMMA', 2, 'POINT')}">
                        S/ 0
                    </h3>
                    <p class="mb-0">Valor Inventario</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>