<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="~{fragments :: head('Mi Perfil - Dashboard')}"></th:block>
    <style>
        .profile-header {
            background: linear-gradient(135deg, var(--primary-color), #2c3e50);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 20px 20px;
        }
        .stat-card {
            transition: transform 0.3s;
            border: none;
            background: #f8f9fa;
        }
        .hover-bg-light:hover {
            background-color: #e9ecef; /* Gris muy suave */
            cursor: pointer;
            transform: translateX(5px); /* Peque침o movimiento a la derecha */
        }
        .stat-card:hover { transform: translateY(-5px); background: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .nav-pills .nav-link { color: #555; font-weight: 500; padding: 15px; border-radius: 10px; }
        .nav-pills .nav-link.active { background-color: var(--primary-color); color: white; }
        .nav-pills .nav-link i { width: 25px; }
    </style>
</head>
<body>
<nav th:replace="~{fragments :: navbar}"></nav>

<div class="profile-header text-center">
    <div class="container">
        <div class="d-inline-block bg-white text-primary rounded-circle p-3 mb-3 shadow">
            <i class="fas fa-user fa-3x"></i>
        </div>
        <h2 class="fw-bold">Hola, <span th:text="${usuario.nombre}">Usuario</span> 游녦</h2>
        <p class="opacity-75">Bienvenido a tu panel personal</p>
    </div>
</div>

<div class="container mb-5" style="min-height: 60vh;">

    <div th:if="${mensaje}" th:class="${'alert alert-' + tipoMensaje + ' alert-dismissible fade show'}" role="alert">
        <i th:if="${tipoMensaje == 'success'}" class="fas fa-check-circle me-2"></i>
        <span th:text="${mensaje}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="row g-4">

        <div class="col-md-4 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-2">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist">
                        <button class="nav-link active text-start" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#v-pills-home" type="button">
                            <i class="fas fa-id-card"></i> Datos Personales
                        </button>
                        <button class="nav-link text-start" id="v-pills-security-tab" data-bs-toggle="pill" data-bs-target="#v-pills-security" type="button">
                            <i class="fas fa-lock"></i> Seguridad
                        </button>
                        <button class="nav-link text-start" id="v-pills-address-tab" data-bs-toggle="pill" data-bs-target="#v-pills-address" type="button">
                            <i class="fas fa-map-marker-alt"></i> Mis Direcciones
                        </button>
                        <hr class="my-2">
                        <a th:href="@{/mis-pedidos}" class="nav-link text-start">
                            <i class="fas fa-box-open"></i> Mis Pedidos
                        </a>
                        <a th:href="@{/logout}" class="nav-link text-start text-danger">
                            <i class="fas fa-sign-out-alt"></i> Cerrar Sesi칩n
                        </a>
                    </div>
                </div>
            </div>

            <div class="card border-0 shadow-sm mt-3 bg-light">
                <div class="card-body">
                    <h6 class="text-muted mb-3">Tu Actividad</h6>
                    <a th:href="@{/mis-pedidos}" class="text-decoration-none text-dark">
                        <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded hover-bg-light" style="transition: 0.2s;">
                            <span><i class="fas fa-shopping-bag text-primary me-2"></i>Pedidos</span>
                            <span class="badge bg-primary rounded-pill" th:text="${cantidadPedidos}">0</span>
                        </div>
                    </a>

                    <a th:href="@{/favoritos}" class="text-decoration-none text-dark">
                        <div class="d-flex justify-content-between align-items-center p-2 rounded hover-bg-light" style="transition: 0.2s;">
                            <span><i class="fas fa-heart text-danger me-2"></i>Favoritos</span>
                            <span class="badge bg-danger rounded-pill" th:text="${cantidadFavoritos}">0</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-8 col-lg-9">
            <div class="tab-content" id="v-pills-tabContent">

                <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0 text-primary">Editar Informaci칩n</h5>
                        </div>
                        <div class="card-body p-4">
                            <form th:action="@{/perfil/actualizar}" method="post">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label small text-muted">Nombre</label>
                                        <input type="text" name="nombre" class="form-control" th:value="${usuario.nombre}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small text-muted">Apellido</label>
                                        <input type="text" name="apellido" class="form-control" th:value="${usuario.apellido}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small text-muted">Email (No editable)</label>
                                        <input type="email" class="form-control bg-light" th:value="${usuario.email}" readonly>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small text-muted">Tel칠fono</label>
                                        <input type="tel" name="telefono" class="form-control" th:value="${usuario.telefono}">
                                    </div>
                                    <div class="col-12 text-end mt-4">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-2"></i>Guardar Cambios
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="v-pills-security" role="tabpanel">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0 text-primary">Cambiar Contrase침a</h5>
                        </div>
                        <div class="card-body p-4">
                            <form th:action="@{/perfil/cambiar-password}" method="post">
                                <div class="mb-3">
                                    <label class="form-label">Contrase침a Actual</label>
                                    <input type="password" name="currentPassword" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Nueva Contrase침a</label>
                                    <input type="password" name="newPassword" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Confirmar Nueva Contrase침a</label>
                                    <input type="password" name="confirmPassword" class="form-control" required>
                                </div>
                                <button type="submit" class="btn btn-warning text-white">Actualizar Contrase침a</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="v-pills-address" role="tabpanel">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 text-primary">Mis Direcciones</h5>
                            <button class="btn btn-sm btn-outline-primary"><i class="fas fa-plus"></i> Nueva</button>
                        </div>
                        <div class="card-body p-4">
                            <div class="border rounded p-3 mb-3 position-relative bg-light">
                                <span class="badge bg-success position-absolute top-0 end-0 m-2">Principal</span>
                                <h6 class="fw-bold mb-1"><i class="fas fa-home me-2"></i>Casa</h6>
                                <p class="mb-1 text-muted">Av. Principal 123, Dpto 401</p>
                                <p class="mb-0 text-muted small">Lima, Per칰</p>
                            </div>

                            <div class="text-center text-muted py-3">
                                <small>Pr칩ximamente podr치s gestionar m칰ltiples direcciones aqu칤.</small>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<footer th:replace="~{fragments :: footer}"></footer>
<div th:replace="~{fragments :: scripts}"></div>
</body>
</html>